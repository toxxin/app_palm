<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>CanFestival: Node-guarding Object</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">CanFestival
   &#160;<span id="projectnumber">3.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group__nodeguardo.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">Node-guarding Object<div class="ingroups"><a class="el" href="group__comobj.html">Communication Objects</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<div class="dynheader">
Collaboration diagram for Node-guarding Object:</div>
<div class="dyncontent">
<center><table><tr><td><img src="group__nodeguardo.png" border="0" alt="" usemap="#group____nodeguardo"/>
<map name="group____nodeguardo" id="group____nodeguardo">
</map>
</td></tr></table></center>
</div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:ga3f81fed5eb843c8baf131915f5826649"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__nodeguardo.html#ga3f81fed5eb843c8baf131915f5826649">nodeguardInit</a> (<a class="el" href="structstruct__CO__Data.html">CO_Data</a> *d)</td></tr>
<tr class="memdesc:ga3f81fed5eb843c8baf131915f5826649"><td class="mdescLeft">&#160;</td><td class="mdescRight">Start node guarding with respect to 0x100C and 0x100D in the object dictionary.  <a href="#ga3f81fed5eb843c8baf131915f5826649">More...</a><br/></td></tr>
<tr class="separator:ga3f81fed5eb843c8baf131915f5826649"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gac259820ffbdf98861fc0e75646fba119"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__nodeguardo.html#gac259820ffbdf98861fc0e75646fba119">nodeguardStop</a> (<a class="el" href="structstruct__CO__Data.html">CO_Data</a> *d)</td></tr>
<tr class="memdesc:gac259820ffbdf98861fc0e75646fba119"><td class="mdescLeft">&#160;</td><td class="mdescRight">Stop producing node guarding messages.  <a href="#gac259820ffbdf98861fc0e75646fba119">More...</a><br/></td></tr>
<tr class="separator:gac259820ffbdf98861fc0e75646fba119"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gab3248945e06e8b05518beddf665f174d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__nodeguardo.html#gab3248945e06e8b05518beddf665f174d">proceedNODE_GUARD</a> (<a class="el" href="structstruct__CO__Data.html">CO_Data</a> *d, <a class="el" href="structMessage.html">Message</a> *m)</td></tr>
<tr class="memdesc:gab3248945e06e8b05518beddf665f174d"><td class="mdescLeft">&#160;</td><td class="mdescRight">This function is responsible to process a canopen-message which seams to be an NMT Error Control Messages. If a BootUp message is detected, it will return the nodeId of the Slave who booted up.  <a href="#gab3248945e06e8b05518beddf665f174d">More...</a><br/></td></tr>
<tr class="separator:gab3248945e06e8b05518beddf665f174d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga58b22c95490ed51c5fd5608ac4f5d148"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__nodeguardo.html#ga58b22c95490ed51c5fd5608ac4f5d148">GuardTimeAlarm</a> (<a class="el" href="structstruct__CO__Data.html">CO_Data</a> *d, UNS32 id)</td></tr>
<tr class="memdesc:ga58b22c95490ed51c5fd5608ac4f5d148"><td class="mdescLeft">&#160;</td><td class="mdescRight">The guardTime - Timer Callback.  <a href="#ga58b22c95490ed51c5fd5608ac4f5d148">More...</a><br/></td></tr>
<tr class="separator:ga58b22c95490ed51c5fd5608ac4f5d148"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga6ca299d2e686313a85093b8a381af80a"><td class="memItemLeft" align="right" valign="top">UNS32&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__nodeguardo.html#ga6ca299d2e686313a85093b8a381af80a">OnNodeGuardUpdate</a> (<a class="el" href="structstruct__CO__Data.html">CO_Data</a> *d, const <a class="el" href="structtd__indextable.html">indextable</a> *unused_indextable, UNS8 unused_bSubindex)</td></tr>
<tr class="separator:ga6ca299d2e686313a85093b8a381af80a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>The node-guarding mechanism for a device is established through cyclically polling all slaves by the NMT master. If one polled slave does not respond during a specified time (LifeTime), the local application will be informed about that event.<br/>
 It is also possible for the slaves to monitor the node-guarding requests coming from the master to determine, if the master operates in a right way</p>
<dl class="todo"><dt><b><a class="el" href="todo.html#_todo000001">Todo:</a></b></dt><dd>The implementation is very basic. The toggle bit of the nodes confirmation is not checked at the moment </dd></dl>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="ga58b22c95490ed51c5fd5608ac4f5d148"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void GuardTimeAlarm </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structstruct__CO__Data.html">CO_Data</a> *&#160;</td>
          <td class="paramname"><em>d</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">UNS32&#160;</td>
          <td class="paramname"><em>id</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The guardTime - Timer Callback. </p>
<p>This function is called every GuardTime (OD 0x100C) ms <br/>
 On every call, a NodeGuard-Request is sent to all nodes which have a node-state not equal to "Unknown" (according to NMTable). If the node has not responded within the lifetime, the nodeguardError function is called and the status of this node is set to "Disconnected"</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">d</td><td>Pointer on a CAN object data structure </td></tr>
    <tr><td class="paramname">id</td><td></td></tr>
  </table>
  </dd>
</dl>
<p>Send node guard request to all nodes except this node, if the node state is not "Unknown_state"</p>
<p>Check if the node has confirmed the guarding request within the LifeTime (GuardTime x LifeTimeFactor)</p>

<p>Definition at line <a class="el" href="lifegrd_8c_source.html#l00210">210</a> of file <a class="el" href="lifegrd_8c_source.html">lifegrd.c</a>.</p>

<p>References <a class="el" href="timer_8c_source.html#l00103">DelAlarm()</a>, and <a class="el" href="nmtMaster_8c_source.html#l00071">masterSendNMTnodeguard()</a>.</p>

<p>Referenced by <a class="el" href="lifegrd_8c_source.html#l00313">nodeguardInit()</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="group__nodeguardo_ga58b22c95490ed51c5fd5608ac4f5d148_cgraph.png" border="0" usemap="#group__nodeguardo_ga58b22c95490ed51c5fd5608ac4f5d148_cgraph" alt=""/></div>
<map name="group__nodeguardo_ga58b22c95490ed51c5fd5608ac4f5d148_cgraph" id="group__nodeguardo_ga58b22c95490ed51c5fd5608ac4f5d148_cgraph">
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ga3f81fed5eb843c8baf131915f5826649"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void nodeguardInit </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structstruct__CO__Data.html">CO_Data</a> *&#160;</td>
          <td class="paramname"><em>d</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Start node guarding with respect to 0x100C and 0x100D in the object dictionary. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*d</td><td>Pointer on a CAN object data structure </td></tr>
  </table>
  </dd>
</dl>
<p>Set initial value for the nodes </p>

<p>Definition at line <a class="el" href="lifegrd_8c_source.html#l00313">313</a> of file <a class="el" href="lifegrd_8c_source.html">lifegrd.c</a>.</p>

<p>References <a class="el" href="lifegrd_8c_source.html#l00210">GuardTimeAlarm()</a>, <a class="el" href="lifegrd_8c_source.html#l00263">OnNodeGuardUpdate()</a>, and <a class="el" href="timer_8c_source.html#l00057">SetAlarm()</a>.</p>

<p>Referenced by <a class="el" href="lifegrd_8c_source.html#l00355">lifeGuardInit()</a>, and <a class="el" href="lifegrd_8c_source.html#l00263">OnNodeGuardUpdate()</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="group__nodeguardo_ga3f81fed5eb843c8baf131915f5826649_cgraph.png" border="0" usemap="#group__nodeguardo_ga3f81fed5eb843c8baf131915f5826649_cgraph" alt=""/></div>
<map name="group__nodeguardo_ga3f81fed5eb843c8baf131915f5826649_cgraph" id="group__nodeguardo_ga3f81fed5eb843c8baf131915f5826649_cgraph">
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="gac259820ffbdf98861fc0e75646fba119"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void nodeguardStop </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structstruct__CO__Data.html">CO_Data</a> *&#160;</td>
          <td class="paramname"><em>d</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Stop producing node guarding messages. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*d</td><td>Pointer on a CAN object data structure </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lifegrd_8c_source.html#l00349">349</a> of file <a class="el" href="lifegrd_8c_source.html">lifegrd.c</a>.</p>

<p>References <a class="el" href="timer_8c_source.html#l00103">DelAlarm()</a>.</p>

<p>Referenced by <a class="el" href="lifegrd_8c_source.html#l00362">lifeGuardStop()</a>, and <a class="el" href="lifegrd_8c_source.html#l00263">OnNodeGuardUpdate()</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="group__nodeguardo_gac259820ffbdf98861fc0e75646fba119_cgraph.png" border="0" usemap="#group__nodeguardo_gac259820ffbdf98861fc0e75646fba119_cgraph" alt=""/></div>
<map name="group__nodeguardo_gac259820ffbdf98861fc0e75646fba119_cgraph" id="group__nodeguardo_gac259820ffbdf98861fc0e75646fba119_cgraph">
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="ga6ca299d2e686313a85093b8a381af80a"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">UNS32 OnNodeGuardUpdate </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structstruct__CO__Data.html">CO_Data</a> *&#160;</td>
          <td class="paramname"><em>d</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="structtd__indextable.html">indextable</a> *&#160;</td>
          <td class="paramname"><em>unused_indextable</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">UNS8&#160;</td>
          <td class="paramname"><em>unused_bSubindex</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>This function is called, if index 0x100C or 0x100D is updated to restart the node-guarding service with the new parameters</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">d</td><td>Pointer on a CAN object data structure </td></tr>
    <tr><td class="paramname">unused_indextable</td><td></td></tr>
    <tr><td class="paramname">unused_bSubindex</td><td></td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="lifegrd_8c_source.html#l00263">263</a> of file <a class="el" href="lifegrd_8c_source.html">lifegrd.c</a>.</p>

<p>References <a class="el" href="lifegrd_8c_source.html#l00313">nodeguardInit()</a>, and <a class="el" href="lifegrd_8c_source.html#l00349">nodeguardStop()</a>.</p>

<p>Referenced by <a class="el" href="lifegrd_8c_source.html#l00313">nodeguardInit()</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="group__nodeguardo_ga6ca299d2e686313a85093b8a381af80a_cgraph.png" border="0" usemap="#group__nodeguardo_ga6ca299d2e686313a85093b8a381af80a_cgraph" alt=""/></div>
<map name="group__nodeguardo_ga6ca299d2e686313a85093b8a381af80a_cgraph" id="group__nodeguardo_ga6ca299d2e686313a85093b8a381af80a_cgraph">
</map>
</div>
</p>

</div>
</div>
<a class="anchor" id="gab3248945e06e8b05518beddf665f174d"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void proceedNODE_GUARD </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structstruct__CO__Data.html">CO_Data</a> *&#160;</td>
          <td class="paramname"><em>d</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structMessage.html">Message</a> *&#160;</td>
          <td class="paramname"><em>m</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This function is responsible to process a canopen-message which seams to be an NMT Error Control Messages. If a BootUp message is detected, it will return the nodeId of the Slave who booted up. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">*d</td><td>Pointer on a CAN object data structure </td></tr>
    <tr><td class="paramname">*m</td><td>Pointer on the CAN-message which has to be analysed. </td></tr>
  </table>
  </dd>
</dl>
<p>Notice that only the master can have sent this node guarding request</p>
<p>Receiving a NMT NodeGuarding (request of the state by the master) Only answer to the NMT NodeGuarding request, the master is not checked (not implemented)</p>
<p>Record node response for node guarding service</p>

<p>Definition at line <a class="el" href="lifegrd_8c_source.html#l00082">82</a> of file <a class="el" href="lifegrd_8c_source.html">lifegrd.c</a>.</p>

<p>References <a class="el" href="can_8h_source.html#l00033">Message::cob_id</a>, <a class="el" href="lifegrd_8c_source.html#l00067">ConsumerHeartbeatAlarm()</a>, <a class="el" href="can_8h_source.html#l00036">Message::data</a>, <a class="el" href="timer_8c_source.html#l00103">DelAlarm()</a>, <a class="el" href="can_8h_source.html#l00035">Message::len</a>, <a class="el" href="can_8h_source.html#l00034">Message::rtr</a>, and <a class="el" href="timer_8c_source.html#l00057">SetAlarm()</a>.</p>

<p>Referenced by <a class="el" href="states_8c_source.html#l00063">canDispatch()</a>.</p>

<p><div class="dynheader">
Here is the call graph for this function:</div>
<div class="dyncontent">
<div class="center"><img src="group__nodeguardo_gab3248945e06e8b05518beddf665f174d_cgraph.png" border="0" usemap="#group__nodeguardo_gab3248945e06e8b05518beddf665f174d_cgraph" alt=""/></div>
<map name="group__nodeguardo_gab3248945e06e8b05518beddf665f174d_cgraph" id="group__nodeguardo_gab3248945e06e8b05518beddf665f174d_cgraph">
</map>
</div>
</p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Fri Aug 21 2015 00:44:19 for CanFestival by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.6 </li>
  </ul>
</div>
</body>
</html>
